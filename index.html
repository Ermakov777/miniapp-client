<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü–†–ò–ü Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <header>
    <h1>üåç –ü–†–ò–ü / –∫–∞—Ä—Ç–∞</h1>
    <div class="actions">
      <button id="buyPro">–ö—É–ø–∏—Ç—å PRO ‚≠ê</button>
      <button id="giftPro">–ü–æ–¥–∞—Ä–∏—Ç—å üéÅ</button>
    </div>
  </header>
  <div id="map"></div>

  <script>
    const API_BASE = "https://YOUR-BOT-HOST.com"; // –∑–∞–º–µ–Ω–∏—Ç–µ
    const PRICE_LABEL = "PRO 30 –¥–Ω–µ–π";

    const tg = window.Telegram.WebApp;
    tg.expand();

    const map = L.map('map').setView([44.6, 37.7], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    async function createInvoice(beneficiaryTgId) {
      try {
        const userId = beneficiaryTgId || (tg.initDataUnsafe?.user?.id);
        if (!userId) throw new Error("–ù–µ—Ç user.id –∏–∑ Telegram WebApp");
        const res = await fetch(`${API_BASE}/invoice`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ beneficiaryTelegramId: userId, label: PRICE_LABEL })
        });
        const data = await res.json();
        if (!data.url) throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª —Å—Å—ã–ª–∫—É –∏–Ω–≤–æ–π—Å–∞");
        tg.openInvoice(data.url);
      } catch (e) {
        tg.showAlert("–û—à–∏–±–∫–∞: " + e.message);
      }
    }

    document.getElementById('buyPro').addEventListener('click', () => createInvoice(null));
    document.getElementById('giftPro').addEventListener('click', async () => {
      const id = prompt("–í–≤–µ–¥–∏—Ç–µ Telegram ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è (—á–∏—Å–ª–æ).");
      if (id) createInvoice(Number(id));
    });
  </script>
</body>
</html>
